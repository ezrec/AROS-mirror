include $(TOP)/config/make.cfg
include make.cfg

o=+$(BUILD_TYPE).o
DEBUG_OPTIONS=
STANDARD_OPTIONS=
ENHANCED_OPTIONS=-DENHANCED

LD = ld
#DEFINES should really not define ENHANCED but for AROS it's fine.
DEFINES := -DENHANCED

OS_INCLUDES_DIR := $(AROSDIR)/Include
INCLUDES_DIR    := $(AROSDIR)/Include

OS_INCLUDES     := -I$(AROSDIR)/Include

USER_INCLUDES   := -I. -I$(INCLUDES_DIR)

INCLUDES        := $(USER_INCLUDES) $(OS_INCLUDES)
CFLAGS          := $(INCLUDES)

INCLUDE_FILES = \
	o/bgui.library_rev.h \
	$(INCLUDES_DIR)/libraries/bgui.h \
	$(INCLUDES_DIR)/libraries/bgui_macros.h \
	$(INCLUDES_DIR)/bgui/bgui_compilerspecific.h \
	$(INCLUDES_DIR)/bgui/bgui.h \
	$(INCLUDES_DIR)/bgui/bgui_image.h \
	$(INCLUDES_DIR)/bgui/bgui_locale.h \
	$(INCLUDES_DIR)/bgui/bgui_asl.h \
	$(INCLUDES_DIR)/bgui/bgui_arexx.h \
	$(INCLUDES_DIR)/bgui/bgui_cx.h \
	$(INCLUDES_DIR)/bgui/bgui_obsolete.h \
	$(INCLUDES_DIR)/bgui/bgui_macros.h \
	$(INCLUDES_DIR)/bgui/bgui_proto.h \
	$(INCLUDES_DIR)/bgui/bgui_pragmas.h \
	$(INCLUDES_DIR)/pragma/bgui_lib.h \
	$(INCLUDES_DIR)/bgui/bgui_lib.fd \
	$(INCLUDES_DIR)/clib/bgui_protos.h \
	$(INCLUDES_DIR)/defines/bgui.h \
	$(INCLUDES_DIR)/proto/bgui.h \
	$(INCLUDES_DIR)/bgui/bgui_bar.h \
	$(INCLUDES_DIR)/libraries/bgui_bar.h \
	$(INCLUDES_DIR)/bgui/bgui_treeview.h \
	$(INCLUDES_DIR)/libraries/bgui_treeview.h \
	$(INCLUDES_DIR)/bgui/bgui_layoutgroup.h \
	$(INCLUDES_DIR)/libraries/bgui_layoutgroup.h \
	$(INCLUDES_DIR)/bgui/bgui_prefs.h

#MM contrib-bgui : contrib-bgui-setup linklib-bgui bgui-prefs bgui-gadgets-common bgui-test bgui-examples
contrib-bgui : bgui-library bgui-gadgets

#MM contrib-bgui-setup : includes linklibs bgui-setup bgui-includes-copy
contrib-bgui-setup : bgui-setup bgui-includes-copy

#MM bgui-gadgets : bgui-gadgets-common
bgui-gadgets : gadgets

#MM clean

#MM contrib-bgui-clean : bgui-test-clean bgui-examples-clean
contrib-bgui-clean : clean

standard_build :
	@$(ECHO) "Making BGUI standard version..."
	@$(MAKE) -f mmakefile BUILD_TYPE=S build

enhanced_build :
	@$(ECHO) "Making BGUI enhanced version..."
	@$(MAKE) -f mmakefile BUILD_TYPE=E build

build : bin/bgui.library.$(BUILD_TYPE)
# tools

gadget_directories = \
gadgets/PopButton \
gadgets/Palette \
gadgets/TreeView \
gadgets/Bar \
gadgets/LayoutGroup

gadgets: $(INCLUDE_FILES) $(gadget_directories)
	$(foreach f,$(gadget_directories), $(MAKE) TOP=$(TOP) -f Makefile.aros -C $(f) all;)


OBJECTS =  \
	o/plmain$(o) \
	o/plboopsi$(o) \
	o/plgfx$(o) \
	o/plgroupclasses$(o) \
	o/plimageclasses$(o) \
	o/plgadgetclasses$(o) \
	o/plaslclasses$(o) \
	o/endtag.o

#MM bgui-setup
bgui-setup : makedirs
	@$(CP) s/Package-Startup $(BGUISDIR)
	@$(CP) s/Package-Shutdown $(BGUISDIR)
        
#MM bgui-includes-copy
bgui-includes-copy : $(INCLUDE_FILES)

#MM bgui-library : bgui-test bgui-examples
bgui-library : enhanced_build

all: makedirs \
	$(INCLUDE_FILES) \
	$(OBJECTS)


clean:
	$(RM) -rf $(INCLUDE_FILES) o/*.o o/*.err
	$(MAKE) TOP=$(TOP) -C gadgets/PopButton -f Makefile.aros clean
	$(MAKE) TOP=$(TOP) -C gadgets/Palette -f Makefile.aros clean
	$(MAKE) TOP=$(TOP) -C gadgets/TreeView -f Makefile.aros clean
	$(MAKE) TOP=$(TOP) -C gadgets/Bar -f Makefile.aros clean
	$(MAKE) TOP=$(TOP) -C gadgets/LayoutGroup -f Makefile.aros clean

makedirs : 
	@$(MKDIR) $(INCLUDES_DIR)
	@$(MKDIR) $(INCLUDES_DIR)/libraries
	@$(MKDIR) $(INCLUDES_DIR)/bgui
	@$(MKDIR) $(INCLUDES_DIR)/pragma
	@$(MKDIR) $(BGUIDIR)
	@$(MKDIR) $(BGUILIBSDIR)
	@$(MKDIR) $(BGUIEXAMPLESDIR)
	@$(MKDIR) $(BGUITESTSDIR)
	@$(MKDIR) $(BGUISDIR)
	@$(MKDIR) $(BGUIPREFSDIR)
	@$(MKDIR) $(BGUICLASSESDIR)
	@$(MKDIR) $(BGUIGADGETSDIR)

        
o/bgui.library_rev.h: bgui.library_rev.rev
	@$(CP) bgui.library_rev.rev o/bgui.library_rev.h

$(INCLUDES_DIR)/libraries/bgui.h : include/libraries_bgui.h
	@$(CP) include/libraries_bgui.h $@

$(INCLUDES_DIR)/libraries/bgui_macros.h : include/libraries_bgui_macros.h
	@$(CP) include/libraries_bgui_macros.h $@

$(INCLUDES_DIR)/bgui/bgui_compilerspecific.h : include/bgui_compilerspecific.h
	@$(CP) include/bgui_compilerspecific.h $@

$(INCLUDES_DIR)/bgui/bgui.h : include/bgui.h
	@$(CP) include/bgui.h $@

$(INCLUDES_DIR)/bgui/bgui_image.h : include/bgui_image.h
	@$(CP) include/bgui_image.h $@

$(INCLUDES_DIR)/bgui/bgui_locale.h : include/bgui_locale.h
	@$(CP) include/bgui_locale.h $@

$(INCLUDES_DIR)/bgui/bgui_asl.h : include/bgui_asl.h
	@$(CP) include/bgui_asl.h $@

$(INCLUDES_DIR)/bgui/bgui_arexx.h : include/bgui_arexx.h
	@$(CP) include/bgui_arexx.h $@

$(INCLUDES_DIR)/bgui/bgui_cx.h : include/bgui_cx.h
	@$(CP) include/bgui_cx.h $@

$(INCLUDES_DIR)/bgui/bgui_obsolete.h : include/bgui_obsolete.h
	@$(CP) include/bgui_obsolete.h $@

$(INCLUDES_DIR)/bgui/bgui_macros.h : include/bgui_macros.h
	@$(CP) include/bgui_macros.h $@

$(INCLUDES_DIR)/bgui/bgui_proto.h : include/bgui_proto.h
	@$(CP) include/bgui_proto.h $@

$(INCLUDES_DIR)/bgui/bgui_pragmas.h : include/bgui_pragmas.h
	@$(CP) include/bgui_pragmas.h $@

$(INCLUDES_DIR)/pragma/bgui_lib.h : include/pragma/bgui_lib.h
	@$(CP) include/pragma/bgui_lib.h $@

$(INCLUDES_DIR)/bgui/bgui_lib.fd : include/bgui_lib.fd
	@$(CP) include/bgui_lib.fd $@

$(INCLUDES_DIR)/clib/bgui_protos.h : include/aros/bgui_protos_clib.h
	@$(CP) include/aros/bgui_protos_clib.h $@

$(INCLUDES_DIR)/defines/bgui.h : include/aros/bgui_defines.h
	@$(CP) include/aros/bgui_defines.h $@

$(INCLUDES_DIR)/proto/bgui.h : include/bgui_proto_aros.h
	@$(CP) $^ $@

#Gadgets includes

$(INCLUDES_DIR)/bgui/bgui_bar.h : gadgets/Bar/include/BarClass.h
	@$(CP) $^ $@

$(INCLUDES_DIR)/libraries/bgui_bar.h : include/libraries_bgui_bar.h
	@$(CP) $^ $@

$(INCLUDES_DIR)/bgui/bgui_treeview.h : gadgets/TreeView/include/TreeViewClass.h
	@$(CP) $^ $@

$(INCLUDES_DIR)/libraries/bgui_treeview.h : include/libraries_bgui_treeview.h
	@$(CP) $^ $@

$(INCLUDES_DIR)/bgui/bgui_layoutgroup.h : gadgets/LayoutGroup/include/LayoutGroupClass.h
	@$(CP) $^ $@

$(INCLUDES_DIR)/libraries/bgui_layoutgroup.h : include/libraries_bgui_layoutgroup.h
	@$(CP) $^ $@

$(INCLUDES_DIR)/bgui/bgui_prefs.h : include/bgui_prefs.h
	@$(CP) $^ $@

bin/bgui.library.$(BUILD_TYPE) : o/libtag.o \
		o/plmain$(o) \
		o/plgfx$(o) \
		o/plboopsi$(o) \
		o/plimageclasses$(o) \
		o/plgadgetclasses$(o) \
		o/plgroupclasses$(o) \
		o/plaslclasses$(o) \
		o/endtag.o
#	if ($(BUILD_TYPE) eq D)
	@$(CC) $(DEBUG_OPTIONS) $(DEFINES) -c ver.c -o o/ver.o
#	endif
#	ifeq ($(BUILD_TYPE),S)
#	@$(CC) $(STANDARD_OPTIONS) $(DEFINES) -c ver.c -o o/ver.o
#	endif
#	ifeq ($(BUILD_TYPE),E)
#	@$(CC) $(ENHANCED_OPTIONS) $(DEFINES) -c ver.c -o o/ver.o
#	endif
	@$(ECHO) Linking $@...
#	@$(CC) -nostartfiles -nostdlib -Wl,-i \
#	      o/libtag.o o/ver.o o/plmain$(o) o/plgfx$(o) o/plboopsi$(o) \
#	      o/plimageclasses$(o) o/plgadgetclasses$(o) o/plaslclasses$(o) \
#	      o/plgroupclasses$(o) o/endtag.o \
#	      -static -i -L$(LIBDIR) -lamiga -larossupport -larosc -larosm -o $@
	@$(STATIC_LD) $(STATIC_LDFLAGS) $(LDFLAGS) \
	      o/libtag.o o/ver.o o/plmain$(o) o/plgfx$(o) o/plboopsi$(o) \
	      o/plimageclasses$(o) o/plgadgetclasses$(o) o/plaslclasses$(o) \
	      o/plgroupclasses$(o) o/endtag.o \
	      -L$(AROS_LIB) -lamiga -larossupport -lrom -larosm -o $@
	@$(ECHO) Installing bgui.library...
	@$(CP) $@ $(BGUIDIR)/Libs/bgui.library

main_o=o/lib$(o) o/libfunc$(o) o/task$(o) o/request$(o) \
	o/misc$(o) o/bgui_locale$(o) o/miscc$(o)
#o/stkext$(o)

boopsi_o=o/classes$(o) o/dgm$(o) o/rootclass$(o)
#o/arexxclass$(o)

gfx_o=o/gfx$(o) o/blitter$(o) o/textclass$(o) o/strformat$(o)

group_o=o/windowclass$(o) o/groupclass$(o) o/spacingclass$(o) o/pageclass$(o) \
   o/viewclass$(o) o/externalclass$(o)

image_o=o/frameclass$(o) o/labelclass$(o) o/separatorclass$(o) o/vectorclass$(o) o/systemiclass$(o)

gadget_o=o/baseclass$(o) o/areaclass$(o) o/buttonclass$(o) \
   o/checkboxclass$(o) o/commodityclass$(o) o/cycleclass$(o) o/indicatorclass$(o) \
   o/infoclass$(o) o/listclass$(o) o/mxclass$(o) o/progressclass$(o) o/propclass$(o) \
   o/sliderclass$(o) o/stringclass$(o) o/radiobuttonclass$(o)

asl_o=o/aslreqclass$(o) o/filereqclass$(o) o/fontreqclass$(o) o/screenreqclass$(o)

o/plmain$(o): $(main_o)
	@echo "Linking $@..."
	@$(RM) -f $@
	@$(LD) -r $(main_o) -o $@ 

o/plboopsi$(o): $(boopsi_o)
	@echo "Linking $@..."
	@$(RM) -f $@
	@$(LD) -r $(boopsi_o) -o $@

o/plgfx$(o): $(gfx_o)
	@echo "Linking $@..."
	@$(RM) -f $@
	@$(LD) -r $(gfx_o) -o $@

o/plgroupclasses$(o): $(group_o)
	@echo "Linking $@..."
	@$(RM) -f $@
	@$(LD) -r $(group_o) -o $@

o/plimageclasses$(o) : $(image_o)
	@echo "Linking $@..."
	@$(RM) -f $@
	@$(LD) -r $(image_o) -o $@

o/plgadgetclasses$(o) : $(gadget_o)
	@echo "Linking $@..."
	@$(RM) -f $@
	@$(LD) -r $(gadget_o) -o $@

o/plaslclasses$(o) : $(asl_o)
	@echo "Linking $@..."
	@$(RM) -f $@
	@$(LD) -r $(asl_o) -o $@

o/libtag.o: libtag.c
	@$(CC) $(INCLUDES) -c $^ -o $@

o/endtag.o: endtag.c
	@$(CC) $(INCLUDES) -c $^ -o $@

o/%$(o): %.c
	@$(CC) $(CFLAGS) $(DEFINES) -c $< -o $@ 2>&1|tee $@.err

